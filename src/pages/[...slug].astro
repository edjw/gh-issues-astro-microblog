---
import BlogPost from "../layouts/BlogPost.astro";

import { getSingleGithubIssue } from "../data/getGithubIssues";
import type { GithubIssueWithSlug } from "../data/getGithubIssues";

const { slug } = Astro.params;

function isEmpty(obj: any) {
    return Object.keys(obj).length === 0;
}

let number: string | undefined;
let page: GithubIssueWithSlug | undefined;

if (slug !== undefined) {
    number = slug.split("-")[0];
}

if (number !== undefined) {
    const post = await getSingleGithubIssue(Number(number));

    if (!isEmpty(post) && post.slug !== undefined && post.slug === slug) {
        page = post;
    }
}

if (page === undefined) return Astro.redirect("/404");
---

{page && <BlogPost {...page} />}
